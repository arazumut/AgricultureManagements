{% extends 'base.html' %}

{% block title %}{{ planting_plan.planned_date }} Tarihli Ekim Planı - Tarım ve Hayvancılık Takip Sistemi{% endblock %}

{% block content %}
<div class="container">
    <!-- Sayfa başlığı ve butonlar -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-clipboard-list me-2"></i>Ekim Planı Detayları</h1>
        <div class="btn-group">
            <a href="{% url 'uretim:planting_plan_list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-1"></i>Ekim Planlarına Dön
            </a>
            <a href="{% url 'uretim:planting_plan_update' planting_plan.id %}" class="btn btn-primary">
                <i class="fas fa-edit me-1"></i>Düzenle
            </a>
            {% if not planting_plan.is_completed %}
                <a href="{% url 'uretim:planting_create' %}?plan_id={{ planting_plan.id }}" class="btn btn-success">
                    <i class="fas fa-seedling me-1"></i>Ekimi Başlat
                </a>
            {% endif %}
        </div>
    </div>
    
    <!-- Mesajlar bölümü -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show mb-4">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
    
    <div class="row">
        <!-- Plan bilgileri kartı -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Plan Bilgileri</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-leaf me-1"></i>Ürün:</strong></p>
                        <p><a href="{% url 'uretim:product_detail' planting_plan.product.id %}">{{ planting_plan.product.name }}</a></p>
                    </div>
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-map-marker-alt me-1"></i>Arazi/Parsel:</strong></p>
                        <p><a href="{% url 'arazi:parcel_detail' land_id=planting_plan.parcel.land.id parcel_id=planting_plan.parcel.id %}">{{ planting_plan.parcel.land.name }} / {{ planting_plan.parcel.parcel_no }}</a></p>
                    </div>
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-calendar-day me-1"></i>Planlanan Ekim Tarihi:</strong></p>
                        <p>{{ planting_plan.planned_date }}</p>
                    </div>
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-ruler-combined me-1"></i>Planlanan Alan:</strong></p>
                        <p>{{ planting_plan.planned_area }} dönüm</p>
                    </div>
                    {% if planting_plan.seed %}
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-seedling me-1"></i>Kullanılacak Tohum:</strong></p>
                        <p><a href="{% url 'uretim:seed_detail' planting_plan.seed.id %}">{{ planting_plan.seed.name }}</a></p>
                    </div>
                    {% endif %}
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-info-circle me-1"></i>Durum:</strong></p>
                        <p>
                            {% if planting_plan.is_completed %}
                                <span class="badge bg-success">Tamamlandı</span>
                            {% else %}
                                {% now "Y-m-d" as current_date %}
                                {% if planting_plan.planned_date|date:"Y-m-d" < current_date %}
                                    <span class="badge bg-danger">Gecikmeli</span>
                                {% elif planting_plan.planned_date|date:"Y-m-d" == current_date %}
                                    <span class="badge bg-warning">Bugün</span>
                                {% else %}
                                    <span class="badge bg-primary">Bekliyor</span>
                                {% endif %}
                            {% endif %}
                        </p>
                    </div>
                    {% if planting_plan.notes %}
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-sticky-note me-1"></i>Notlar:</strong></p>
                        <p>{{ planting_plan.notes|linebreaks }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Plan durumu kartı -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Plan Durumu</h5>
                </div>
                <div class="card-body">
                    {% if planting_plan.is_completed %}
                        <div class="alert alert-success mb-4">
                            <h5 class="mb-0"><i class="fas fa-check-circle me-2"></i>Bu plan tamamlandı!</h5>
                        </div>
                        {% if related_planting %}
                            <div class="mb-4">
                                <h6 class="mb-3">Bağlantılı Ekim</h6>
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="mb-1">{{ related_planting.product.name }} Ekimi</h6>
                                                <p class="small text-muted mb-0">
                                                    {{ related_planting.planting_date }} - {{ related_planting.area }} dönüm
                                                </p>
                                            </div>
                                            <a href="{% url 'uretim:planting_detail' related_planting.id %}" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye me-1"></i>Detaylar
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% else %}
                        {% now "Y-m-d" as current_date %}
                        {% if planting_plan.planned_date|date:"Y-m-d" < current_date %}
                            <div class="alert alert-danger mb-4">
                                <h5 class="mb-2"><i class="fas fa-exclamation-triangle me-2"></i>Planlanan Tarih Geçmiş</h5>
                                <p class="mb-0">Planlanan ekim tarihi {{ planting_plan.planned_date }} idi. Ekimi başlatmak için "Ekimi Başlat" butonuna tıklayın.</p>
                            </div>
                        {% elif planting_plan.planned_date|date:"Y-m-d" == current_date %}
                            <div class="alert alert-warning mb-4">
                                <h5 class="mb-2"><i class="fas fa-exclamation-circle me-2"></i>Ekim Tarihi Bugün</h5>
                                <p class="mb-0">Planlanan ekim tarihi bugün. Ekimi başlatmak için "Ekimi Başlat" butonuna tıklayın.</p>
                            </div>
                        {% else %}
                            <div class="alert alert-info mb-4">
                                <h5 class="mb-2"><i class="fas fa-info-circle me-2"></i>Planlanan Tarih Yaklaşıyor</h5>
                                <p class="mb-0">Planlanan ekim tarihi: {{ planting_plan.planned_date }}</p>
                            </div>
                            
                            <div class="text-center mb-4">
                                <p class="mb-2">Planlanan tarihe kalan süre:</p>
                                <h4>
                                    {% with days_left=current_date|timeuntil:planting_plan.planned_date %}
                                    {{ days_left }}
                                    {% endwith %}
                                </h4>
                            </div>
                        {% endif %}
                        
                        <div class="mt-4 text-center">
                            <a href="{% url 'uretim:planting_create' %}?plan_id={{ planting_plan.id }}" class="btn btn-success btn-lg">
                                <i class="fas fa-seedling me-1"></i>Ekimi Başlat
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ek bilgiler -->
    <div class="row">
        <!-- Ürün bilgileri -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Ürün Bilgileri</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-seedling me-1"></i>Ürün Adı:</strong></p>
                        <p>{{ planting_plan.product.name }}</p>
                    </div>
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-tag me-1"></i>Tür:</strong></p>
                        <p>{{ planting_plan.product.get_product_type_display }}</p>
                    </div>
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-leaf me-1"></i>Çeşit:</strong></p>
                        <p>{{ planting_plan.product.variety }}</p>
                    </div>
                    {% if planting_plan.product.growing_time %}
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-clock me-1"></i>Yetişme Süresi:</strong></p>
                        <p>{{ planting_plan.product.growing_time }} gün</p>
                    </div>
                    {% endif %}
                    <div class="text-center mt-4">
                        <a href="{% url 'uretim:product_detail' planting_plan.product.id %}" class="btn btn-outline-primary">
                            <i class="fas fa-info-circle me-1"></i>Ürün Detaylarına Git
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Parsel bilgileri -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Parsel Bilgileri</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-map me-1"></i>Parsel No:</strong></p>
                        <p>{{ planting_plan.parcel.parcel_no }}</p>
                    </div>
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-map-marked-alt me-1"></i>Arazi:</strong></p>
                        <p>{{ planting_plan.parcel.land.name }}</p>
                    </div>
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-ruler-combined me-1"></i>Parsel Alanı:</strong></p>
                        <p>{{ planting_plan.parcel.area }} dönüm</p>
                    </div>
                    <div class="mb-3">
                        <p class="mb-1"><strong><i class="fas fa-water me-1"></i>Sulama Durumu:</strong></p>
                        <p>
                            {% if planting_plan.parcel.has_irrigation %}
                                <span class="badge bg-success">Sulanabilir</span>
                            {% else %}
                                <span class="badge bg-secondary">Sulanamaz</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="text-center mt-4">
                        <a href="{% url 'arazi:parcel_detail' land_id=planting_plan.parcel.land.id parcel_id=planting_plan.parcel.id %}" class="btn btn-outline-primary">
                            <i class="fas fa-info-circle me-1"></i>Parsel Detaylarına Git
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 